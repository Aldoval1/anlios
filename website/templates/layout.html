<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Anlios Bot Dashboard{% endblock %}</title>
    
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- CHANGE: Load the base stylesheet first -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes-base.css') }}">

    <!-- Link all theme stylesheets (disabled by default) -->
    <link id="design-anlios" rel="stylesheet" href="{{ url_for('static', filename='css/designs/design-anlios.css') }}" disabled>
    <link id="design-modern" rel="stylesheet" href="{{ url_for('static', filename='css/designs/design-modern.css') }}" disabled>
    <link id="design-terminal" rel="stylesheet" href="{{ url_for('static', filename='css/designs/design-terminal.css') }}" disabled>
    <link id="design-blueprint" rel="stylesheet" href="{{ url_for('static', filename='css/designs/design-blueprint.css') }}" disabled>
    <link id="design-discord" rel="stylesheet" href="{{ url_for('static', filename='css/designs/design-discord.css') }}" disabled>
    <link id="design-neumorphism" rel="stylesheet" href="{{ url_for('static', filename='css/designs/design-neumorphism.css') }}" disabled>
    <link id="design-nordic" rel="stylesheet" href="{{ url_for('static', filename='css/designs/design-nordic.css') }}" disabled>

    <link id="color-furia-roja" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-furia-roja.css') }}" disabled>
    <link id="color-oceano-neon" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-oceano-neon.css') }}" disabled>
    <link id="color-atardecer" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-atardecer.css') }}" disabled>
    <link id="color-bosque-encantado" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-bosque-encantado.css') }}" disabled>
    <link id="color-menta-glacial" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-menta-glacial.css') }}" disabled>
    <link id="color-cerezo-en-flor" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-cerezo-en-flor.css') }}" disabled>
    <link id="color-grafito-y-oro" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-grafito-y-oro.css') }}" disabled>
    <link id="color-tierra-y-cielo" rel="stylesheet" href="{{ url_for('static', filename='css/colors/color-tierra-y-cielo.css') }}" disabled>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toast.css') }}">
</head>
<body>

    {% block body_content %}{% endblock %}

    <!-- Contenedor para las notificaciones Toast -->
    <div id="toast-container">
        <img id="toast-gif" src="{{ url_for('static', filename='images/warning.gif') }}" alt="Notification Status">
        <div class="toast-card">
            <div class="toast-content">
                <p id="toast-message">Tienes cambios sin guardar.</p>
                <div id="toast-buttons">
                    <button id="toast-confirm" class="btn btn-success btn-sm">Guardar</button>
                    <button id="toast-cancel" class="btn btn-danger btn-sm">Cancelar</button>
                </div>
                <div class="toast-progress-bar">
                    <div id="toast-progress"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/toast.js') }}"></script>
    <script src="{{ url_for('static', filename='js/demo.js') }}"></script>
    
    <!-- Script for theme switching -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const designSheets = document.querySelectorAll('link[id^="design-"]');
            const colorSheets = document.querySelectorAll('link[id^="color-"]');
            const designSelector = document.getElementById('design-selector');
            const colorSelector = document.getElementById('color-selector');
            const body = document.body;

            let previewedDesign = null;
            let previewedColor = null;

            function applyTheme(design, color) {
                body.classList.add('theme-transition');

                designSheets.forEach(sheet => sheet.disabled = (sheet.id !== `design-${design}`));
                colorSheets.forEach(sheet => sheet.disabled = (sheet.id !== `color-${color}`));

                setTimeout(() => body.classList.remove('theme-transition'), 500);
            }

            function saveTheme(design, color) {
                localStorage.setItem('userTheme', JSON.stringify({ design, color }));
            }

            function loadTheme() {
                const savedTheme = JSON.parse(localStorage.getItem('userTheme')) || { design: 'anlios', color: 'furia-roja' };
                previewedDesign = savedTheme.design;
                previewedColor = savedTheme.color;
                applyTheme(savedTheme.design, savedTheme.color);
                updateSelectors();
            }
            
            function updateSelectors() {
                if(designSelector) {
                    designSelector.querySelectorAll('.theme-card').forEach(card => {
                        card.classList.toggle('active', card.dataset.design === previewedDesign);
                    });
                }
                if(colorSelector) {
                    colorSelector.querySelectorAll('.color-swatch').forEach(swatch => {
                        swatch.classList.toggle('active', swatch.dataset.color === previewedColor);
                    });
                }
            }

            // Event Listeners for theme selection (on profile page)
            if (designSelector && colorSelector) {
                designSelector.addEventListener('click', e => {
                    const card = e.target.closest('.theme-card');
                    if (card) {
                        previewedDesign = card.dataset.design;
                        applyTheme(previewedDesign, previewedColor);
                        updateSelectors();
                        window.showThemeToast();
                    }
                });

                colorSelector.addEventListener('click', e => {
                    const swatch = e.target.closest('.color-swatch');
                    if (swatch) {
                        previewedColor = swatch.dataset.color;
                        applyTheme(previewedDesign, previewedColor);
                        updateSelectors();
                        window.showThemeToast();
                    }
                });
                
                window.savePreviewedTheme = () => {
                    saveTheme(previewedDesign, previewedColor);
                };
                
                window.revertToSavedTheme = () => {
                    loadTheme();
                };
            }

            // Initial theme load on all pages
            loadTheme();
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>